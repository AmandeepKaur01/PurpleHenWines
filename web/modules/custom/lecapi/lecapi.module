<?php

/**
 * @file
 * Main module for Lil Engine Content API.
 */

use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Field\WidgetBase;
use Drupal\paragraphs\Entity\Paragraph;
use Drupal\paragraphs\Plugin\Field\FieldWidget\ParagraphsWidget;
use Drupal\lecapi\Ia;

/**
 * Implements hook_field_widget_WIDGET_TYPE_form_alter().
 */
function lecapi_field_widget_paragraphs_form_alter(&$element, FormStateInterface $form_state, $context) {
  return;
  /** @var \Drupal\field\Entity\FieldConfig $field_definition */
  $field_definition = $context['items']->getFieldDefinition();
//  $paragraph_entity_reference_field_name =

  if ( $field_definition->getName() == Ia::FIELD_CONTENT) {
    $widget_state = WidgetBase::getWidgetState($element['#field_parents'], Ia::FIELD_CONTENT, $form_state);
    /** @var Drupal\paragraphs\Entity\Paragraph $paragraph  */
    $paragraph = $widget_state['paragraphs'][$element['#delta']]['entity'];

    // Determine which paragraph type is being embedded.
    if ($paragraph_instance->bundle() == Ia::PG_CTA) {
      $selector = sprintf('select[name="%s[%d][subform][%s]"]', Ia::FIELD_CONTENT, $element['#delta'], Ia::FIELD_VARIANT);

      // Dependent fields.
      $element['subform'][Ia::FIELD_HEADING]['#states'] = [
        'visible' => [
          $selector => ['value' => Ia::PG_CTA],
        ],
      ];
    }
  }
}
